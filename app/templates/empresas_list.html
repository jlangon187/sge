{% extends "base.html" %}

{% block title %}Listado de Empresas{% endblock %}

{% block page_content %}
<div class="row" style="margin-top: 20px; margin-bottom: 20px;">
    <div class="col-md-6">
        <h1 style="margin:0; font-weight:800; color:#111827;">
            <i class="fas fa-building" style="color:#4f46e5;"></i> Empresas
        </h1>
        <p class="text-muted">Gestión de clientes y organizaciones.</p>
    </div>
    <div class="col-md-6 text-right" style="margin-top: 10px;">
        <a href="{{ url_for('empresas.crear_empresa_admin') }}" class="btn btn-primary btn-lg" style="border-radius: 50px; padding: 10px 25px; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);">
            <i class="fas fa-plus"></i> Nueva Empresa
        </a>
    </div>
</div>

<div class="row">
    {% for empresa in empresas %}
    <div class="col-md-4">
        <div class="panel panel-default" style="border: none; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border-radius: 12px; transition: transform 0.2s;">
            <div class="panel-body" style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <h3 style="margin-top: 0; font-weight: bold; color: #1f2937;">{{ empresa.nombrecomercial }}</h3>

                    <a href="{{ url_for('empresas.borrar_empresa_admin', id=empresa.id_empresa) }}"
                       class="btn btn-danger btn-sm"
                       onclick="return confirm('¿Estás seguro de que quieres eliminar la empresa {{ empresa.nombrecomercial }}? Esta acción borrará también a todos sus empleados.');"
                       title="Eliminar Empresa"
                       style="border-radius: 50%; width: 30px; height: 30px; padding: 0; line-height: 30px;">
                        <i class="fas fa-trash-alt" style="font-size: 12px;"></i>
                    </a>
                </div>

                <p style="color: #6b7280; font-size: 13px; margin-bottom: 15px;">
                    <i class="fas fa-id-badge"></i> {{ empresa.cif }}<br>
                    <i class="fas fa-map-marker-alt"></i> {{ empresa.localidad }}
                </p>

                <div style="background-color: #f9fafb; padding: 10px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">

                    {% set num_empleados = empresa.trabajadores|length %}

                    <div>
                        <span style="display: block; font-size: 11px; color: #6b7280; text-transform: uppercase;">Plantilla</span>
                        <span style="font-weight: bold; color: #111827;">{{ num_empleados }} Empleados</span>
                    </div>

                    {% if num_empleados > 0 %}
                        <span class="label label-success" style="border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-check" style="font-size: 10px;"></i>
                        </span>
                    {% else %}
                        <span class="label label-default" style="border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;">
                            0
                        </span>
                    {% endif %}
                </div>

                <a href="{{ url_for('empresas.seleccionar_empresa', id=empresa.id_empresa) }}" class="btn btn-default btn-block" style="margin-top: 15px; border-color: #e5e7eb; color: #4f46e5; font-weight: 500;">
                    Gestionar
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-md-12 text-center" style="padding: 50px;">
        <i class="fas fa-building" style="font-size: 50px; color: #d1d5db; margin-bottom: 20px;"></i>
        <h3 class="text-muted">No hay empresas registradas</h3>
    </div>
    {% endfor %}
</div>
{% endblock %}